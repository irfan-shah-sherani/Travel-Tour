<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Form</title>

    <link rel="stylesheet" href="/public/form.css" />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Droid+Arabic+Kufi&display=swap"
      rel="stylesheet"
    />

    <!-- <link
      href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Droid+Arabic+Kufi&display=swap"
      rel="stylesheet"
    /> -->
  </head>
  <body>
    <!-- Header -->
    <div class="header">
      <div class="header_left_logo">
        <img src="/source/headerleftlogo.png" alt="left logo" />
      </div>
      <div class="header_right_logo">
        <img src="/source/main_logo.png" alt="main logo" />
      </div>
    </div>

    <!-- Main -->
    <main class="main">
      <div class="center_page">
        <!-- Page Header -->
        <div class="page_header">
          <div class="page_button"><button>العودة</button></div>
          <div class="page_heading">التحقق من الوثائق</div>
        </div>

        <!-- Paragraph -->
        <div class="paragraph">
          <p>
            خدمة تتيح التحقق من الوثائق التي تم تصديقها إلكترونيا عبر بوابة
            خدمات المشتركين وللتحقق من شهادة الاشتراك الرجاء ادخال الرقم المرجعي
            الخاص بالوثيقة.
          </p>
        </div>

        <!-- Page Content -->
        <div class="page_main_content">
          <div class="content_row">
            <div class="main_content">
              <div class="content_text">
                <span class="span">إسم الغرفة</span>
                <span id="room_name" class="span2"></span>
              </div>
            </div>
            <div class="main_content">
              <div class="content_text">
                <span class="span">إسم المنشأة</span>
                <span id="facility_name" class="span2"></span>
              </div>
            </div>
          </div>

          <div class="content_row">
            <div class="main_content">
              <div class="content_text">
                <span class="span">رقم المنشأة</span>
                <span id="facility_number" class="span2"></span>
              </div>
            </div>
          </div>

          <div class="content_row">
            <div class="main_content">
              <div class="content_text">
                <span class="span">رقم الطلب</span>
                <span id="request_number" class="span2"></span>
              </div>
            </div>
            <div class="main_content">
              <div class="content_text">
                <span class="span">نوع الطلب</span>
                <span id="request_type" class="span2"></span>
              </div>
            </div>
          </div>

          <div class="content_row">
            <div class="main_content">
              <div class="content_text">
                <span class="span">إسم مقدم الطلب</span>
                <span id="applicant_name" class="span2"></span>
              </div>
            </div>
            <div class="main_content">
              <div class="content_text">
                <span class="span">تاريخ ووقت إنشاء الطلب</span>
                <span id="request_datetime" class="span2"></span>
              </div>
            </div>
          </div>

          <div class="content_row">
            <div class="main_content">
              <div class="content_text">
                <span class="span">مبلغ الطلب</span>
                <span id="request_amount" class="span2"></span>
              </div>
            </div>
            <div class="main_content">
              <div class="content_text">
                <span class="span">تاريخ صلاحية الطلب</span>
                <span id="request_validity" class="span2"></span>
              </div>
            </div>
          </div>

          <div class="content_row">
            <div class="main_content">
              <div class="content_text">
                <span class="span">رقم السجل التجاري</span>
                <span id="Registration_Number" class="span2"></span>
              </div>
            </div>
            <div class="main_content">
              <div class="content_text">
                <span class="span">حالة الطلب</span>
                <span
                  id="request_status"
                  class="span2"
                  style="color: #28a745"
                ></span>
              </div>
            </div>
          </div>
        </div>

        <!-- Buttons -->
        <div class="btn">
          <label class="open-modal-btn button">التحقق مرة أخري</label>
          <label class="open-modal-btn button" onclick="downloadPDF()"
            >تحميل</label
          >

          <script>
            function downloadPDF() {
              const element = document.body; // or document.getElementById("content") for specific section

              const opt = {
                margin: 0.5,
                filename: "page.pdf",
                image: { type: "jpeg", quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: "in", format: "a4", orientation: "portrait" },
              };

              html2pdf().set(opt).from(element).save();
            }
          </script>
        </div>
      </div>
    </main>
    <!-- Footer -->
    <div class="footer">
      <div class="footer_content">
        <img
          src="https://eservices-ucci.org/assets/images/ssl_secure.png"
          alt="ssl"
          style="height: 40px"
        />
        <div class="footer_left_heading">يفضل استخدام متصفح جوجل كروم</div>
        <div class="icons">
          <a href="#"><i class="fab fa-facebook-f icon"></i></a>
          <a href="#"><i class="fab fa-twitter icon"></i></a>
          <a href="#"><i class="fab fa-youtube icon"></i></a>
          <a href="#"><i class="fab fa-linkedin-in icon"></i></a>
        </div>
      </div>

      <div class="footer_content1">
        <div class="footer_support_title">للإستفسار والدعم الفني</div>
        <div class="footer_support_number">00966112641362</div>
      </div>

      <div class="footer_content2">
        <div class="footer_dev_text">تطوير وتشغيل</div>
        <div class="footer_logo">
          <img
            src="https://eservices-ucci.org/assets/images/worldofss-logo.png"
            alt="logo"
            style="height: 40px"
          />
        </div>
      </div>
    </div>

    <div class="footer-copyright">
      جميع الحقوق محفوظة الغرفة التجارية في عنيزة ©
      <span class="year-text">2025</span>
    </div>
    <script>
      const token = new URLSearchParams(window.location.search).get("token");

      fetch(`/form-record?token=${token}`)
        .then((res) => res.json())
        .then((data) => {
          if (data.error) {
            alert("لم يتم العثور على البيانات.");
            return;
          }

          // ✅ Corrected field mapping based on TravalRecord columns
          document.getElementById("room_name").innerText = data.room_name || "";
          document.getElementById("facility_name").innerText =
            data.facility_name || "";
          document.getElementById("facility_number").innerText =
            data.facility_number || "";
          document.getElementById("request_number").innerText =
            data.request_number || "";
          document.getElementById("request_type").innerText =
            data.request_type || "";
          document.getElementById("applicant_name").innerText =
            data.applicant_name || "";
          document.getElementById("request_datetime").innerText = (
            data.creation_date || ""
          ).split("T")[0];
          document.getElementById("request_amount").innerText =
            data.request_amount || "";
          document.getElementById("request_validity").innerText = (
            data.expiry_date || ""
          ).split("T")[0];
          document.getElementById("Registration_Number").innerText =
            data.record_number || "";
          document.getElementById("request_status").innerText =
            data.request_status || "";
        })
        .catch((err) => {
          console.error("Error fetching data:", err);
        });
        html2pdf().set({ margin: 0, filename: 'page.pdf', image: { type: 'jpeg', quality: 1 }, html2canvas: { scale: 2 }, jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' } }).from(document.body).save();

    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  </body>
</html>
